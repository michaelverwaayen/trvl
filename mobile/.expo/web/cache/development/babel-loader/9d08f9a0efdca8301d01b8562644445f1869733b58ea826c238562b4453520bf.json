{"ast":null,"code":"var _jsxFileName = \"/Users/michaelverwaayen/RFQ/mobile/ChatFlowRouter.js\";\nimport React, { useState } from 'react';\nimport ChatScreen from './ChatScreen';\nimport ReviewTicketScreen from './ReviewTicketScreen';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatFlowRouter({\n  onBackToHome\n}) {\n  const [messages, setMessages] = useState([]);\n  const [chatHistory, setChatHistory] = useState('');\n  const [showReview, setShowReview] = useState(false);\n  const [chatRoomId, setChatRoomId] = useState(null);\n  const handleChatUpdate = (newMessages, fullTranscript) => {\n    setMessages(newMessages);\n    setChatHistory(fullTranscript);\n    const highConfidence = newMessages.some(m => m.role === 'assistant' && (m.content.toLowerCase().includes('confidence: 85') || m.content.toLowerCase().includes('high confidence')));\n    if (highConfidence) {\n      setShowReview(true);\n    }\n  };\n  const handleManualSubmit = () => {\n    setShowReview(true);\n  };\n  const handleUrgentDispatch = async () => {\n    try {\n      const res = await axios.post('http://localhost:3000/dispatch_urgent_vendor', {\n        chat_history: chatHistory\n      });\n      if (res.data.success && res.data.chat_room_id) {\n        setChatRoomId(res.data.chat_room_id);\n        alert('✅ Urgent vendor found. Opening chat...');\n      } else {\n        alert('⚠️ No vendor available for urgent dispatch. Submitting RFQ instead.');\n        setShowReview(true);\n      }\n    } catch (err) {\n      console.error('Urgent dispatch failed:', err);\n      setShowReview(true);\n    }\n  };\n  const handleRFQSubmit = async editedTicket => {\n    try {\n      const res = await axios.post('http://localhost:3000/submit-rfq', editedTicket);\n      console.log('RFQ submitted:', res.data);\n      setShowReview(false);\n      onBackToHome();\n    } catch (err) {\n      console.error('Error submitting RFQ:', err);\n      alert('Failed to submit RFQ. Please try again.');\n    }\n  };\n  return showReview ? _jsxDEV(ReviewTicketScreen, {\n    chatHistory: chatHistory,\n    onSubmit: handleRFQSubmit,\n    onBack: () => setShowReview(false)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this) : _jsxDEV(ChatScreen, {\n    messages: messages,\n    onUpdate: handleChatUpdate,\n    onManualSubmit: handleManualSubmit,\n    onUrgentHelp: handleUrgentDispatch\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"names":["React","useState","ChatScreen","ReviewTicketScreen","axios","jsxDEV","_jsxDEV","ChatFlowRouter","onBackToHome","messages","setMessages","chatHistory","setChatHistory","showReview","setShowReview","chatRoomId","setChatRoomId","handleChatUpdate","newMessages","fullTranscript","highConfidence","some","m","role","content","toLowerCase","includes","handleManualSubmit","handleUrgentDispatch","res","post","chat_history","data","success","chat_room_id","alert","err","console","error","handleRFQSubmit","editedTicket","log","onSubmit","onBack","fileName","_jsxFileName","lineNumber","columnNumber","onUpdate","onManualSubmit","onUrgentHelp"],"sources":["/Users/michaelverwaayen/RFQ/mobile/ChatFlowRouter.js"],"sourcesContent":["import React, { useState } from 'react';\nimport ChatScreen from './ChatScreen';\nimport ReviewTicketScreen from './ReviewTicketScreen';\nimport axios from 'axios';\n\nexport default function ChatFlowRouter({ onBackToHome }) {\n  const [messages, setMessages] = useState([]);\n  const [chatHistory, setChatHistory] = useState('');\n  const [showReview, setShowReview] = useState(false);\n  const [chatRoomId, setChatRoomId] = useState(null);\n\n  const handleChatUpdate = (newMessages, fullTranscript) => {\n    setMessages(newMessages);\n    setChatHistory(fullTranscript);\n\n    const highConfidence = newMessages.some(m =>\n      m.role === 'assistant' &&\n      (m.content.toLowerCase().includes('confidence: 85') ||\n       m.content.toLowerCase().includes('high confidence'))\n    );\n\n    if (highConfidence) {\n      setShowReview(true);\n    }\n  };\n\n  const handleManualSubmit = () => {\n    setShowReview(true);\n  };\n\n  const handleUrgentDispatch = async () => {\n    try {\n      const res = await axios.post('http://localhost:3000/dispatch_urgent_vendor', {\n        chat_history: chatHistory\n      });\n\n      if (res.data.success && res.data.chat_room_id) {\n        setChatRoomId(res.data.chat_room_id);\n        alert('✅ Urgent vendor found. Opening chat...');\n        // Optional: Navigate to VendorChatRoom\n      } else {\n        alert('⚠️ No vendor available for urgent dispatch. Submitting RFQ instead.');\n        setShowReview(true);\n      }\n    } catch (err) {\n      console.error('Urgent dispatch failed:', err);\n      setShowReview(true);\n    }\n  };\n\n  const handleRFQSubmit = async (editedTicket) => {\n    try {\n      const res = await axios.post('http://localhost:3000/submit-rfq', editedTicket);\n      console.log('RFQ submitted:', res.data);\n      setShowReview(false);\n      onBackToHome();\n    } catch (err) {\n      console.error('Error submitting RFQ:', err);\n      alert('Failed to submit RFQ. Please try again.');\n    }\n  };\n\n  return showReview ? (\n    <ReviewTicketScreen\n      chatHistory={chatHistory}\n      onSubmit={handleRFQSubmit}\n      onBack={() => setShowReview(false)}\n    />\n  ) : (\n    <ChatScreen\n      messages={messages}\n      onUpdate={handleChatUpdate}\n      onManualSubmit={handleManualSubmit}\n      onUrgentHelp={handleUrgentDispatch}\n    />\n  );\n}\n"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,QAAQ,QAAQ,OAAO;AACvC,OAAOC,UAAU,MAAM,cAAc;AACrC,OAAOC,kBAAkB,MAAM,sBAAsB;AACrD,OAAOC,KAAK,MAAM,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1B,eAAe,SAASC,cAAcA,CAAC;EAAEC;AAAa,CAAC,EAAE;EACvD,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGT,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAACU,WAAW,EAAEC,cAAc,CAAC,GAAGX,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACY,UAAU,EAAEC,aAAa,CAAC,GAAGb,QAAQ,CAAC,KAAK,CAAC;EACnD,MAAM,CAACc,UAAU,EAAEC,aAAa,CAAC,GAAGf,QAAQ,CAAC,IAAI,CAAC;EAElD,MAAMgB,gBAAgB,GAAGA,CAACC,WAAW,EAAEC,cAAc,KAAK;IACxDT,WAAW,CAACQ,WAAW,CAAC;IACxBN,cAAc,CAACO,cAAc,CAAC;IAE9B,MAAMC,cAAc,GAAGF,WAAW,CAACG,IAAI,CAACC,CAAC,IACvCA,CAAC,CAACC,IAAI,KAAK,WAAW,KACrBD,CAAC,CAACE,OAAO,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,gBAAgB,CAAC,IAClDJ,CAAC,CAACE,OAAO,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,iBAAiB,CAAC,CACtD,CAAC;IAED,IAAIN,cAAc,EAAE;MAClBN,aAAa,CAAC,IAAI,CAAC;IACrB;EACF,CAAC;EAED,MAAMa,kBAAkB,GAAGA,CAAA,KAAM;IAC/Bb,aAAa,CAAC,IAAI,CAAC;EACrB,CAAC;EAED,MAAMc,oBAAoB,GAAG,MAAAA,CAAA,KAAY;IACvC,IAAI;MACF,MAAMC,GAAG,GAAG,MAAMzB,KAAK,CAAC0B,IAAI,CAAC,8CAA8C,EAAE;QAC3EC,YAAY,EAAEpB;MAChB,CAAC,CAAC;MAEF,IAAIkB,GAAG,CAACG,IAAI,CAACC,OAAO,IAAIJ,GAAG,CAACG,IAAI,CAACE,YAAY,EAAE;QAC7ClB,aAAa,CAACa,GAAG,CAACG,IAAI,CAACE,YAAY,CAAC;QACpCC,KAAK,CAAC,wCAAwC,CAAC;MAEjD,CAAC,MAAM;QACLA,KAAK,CAAC,qEAAqE,CAAC;QAC5ErB,aAAa,CAAC,IAAI,CAAC;MACrB;IACF,CAAC,CAAC,OAAOsB,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,yBAAyB,EAAEF,GAAG,CAAC;MAC7CtB,aAAa,CAAC,IAAI,CAAC;IACrB;EACF,CAAC;EAED,MAAMyB,eAAe,GAAG,MAAOC,YAAY,IAAK;IAC9C,IAAI;MACF,MAAMX,GAAG,GAAG,MAAMzB,KAAK,CAAC0B,IAAI,CAAC,kCAAkC,EAAEU,YAAY,CAAC;MAC9EH,OAAO,CAACI,GAAG,CAAC,gBAAgB,EAAEZ,GAAG,CAACG,IAAI,CAAC;MACvClB,aAAa,CAAC,KAAK,CAAC;MACpBN,YAAY,CAAC,CAAC;IAChB,CAAC,CAAC,OAAO4B,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEF,GAAG,CAAC;MAC3CD,KAAK,CAAC,yCAAyC,CAAC;IAClD;EACF,CAAC;EAED,OAAOtB,UAAU,GACfP,OAAA,CAACH,kBAAkB;IACjBQ,WAAW,EAAEA,WAAY;IACzB+B,QAAQ,EAAEH,eAAgB;IAC1BI,MAAM,EAAEA,CAAA,KAAM7B,aAAa,CAAC,KAAK;EAAE;IAAA8B,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACpC,CAAC,GAEFzC,OAAA,CAACJ,UAAU;IACTO,QAAQ,EAAEA,QAAS;IACnBuC,QAAQ,EAAE/B,gBAAiB;IAC3BgC,cAAc,EAAEtB,kBAAmB;IACnCuB,YAAY,EAAEtB;EAAqB;IAAAgB,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACpC,CACF;AACH","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}