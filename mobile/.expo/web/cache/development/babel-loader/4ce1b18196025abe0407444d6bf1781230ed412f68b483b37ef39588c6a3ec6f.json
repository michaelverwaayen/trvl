{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState } from 'react';\nimport ChatScreen from \"./ChatScreen\";\nimport ReviewTicketScreen from \"./ReviewTicketScreen\";\nimport axios from 'axios';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function ChatFlowRouter(_ref) {\n  var onBackToHome = _ref.onBackToHome;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    chatHistory = _useState4[0],\n    setChatHistory = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    showReview = _useState6[0],\n    setShowReview = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    chatRoomId = _useState8[0],\n    setChatRoomId = _useState8[1];\n  var handleChatUpdate = function handleChatUpdate(newMessages, fullTranscript) {\n    setMessages(newMessages);\n    setChatHistory(fullTranscript);\n    var highConfidence = newMessages.some(function (m) {\n      return m.role === 'assistant' && (m.content.toLowerCase().includes('confidence: 85') || m.content.toLowerCase().includes('high confidence'));\n    });\n    if (highConfidence) {\n      setShowReview(true);\n    }\n  };\n  var handleManualSubmit = function handleManualSubmit() {\n    setShowReview(true);\n  };\n  var handleUrgentDispatch = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var res = yield axios.post('https://rfq-a1og.onrender.com/dispatch_urgent_vendor', {\n          chat_history: chatHistory\n        });\n        if (res.data.success && res.data.chat_room_id) {\n          setChatRoomId(res.data.chat_room_id);\n          alert('✅ Urgent vendor found. Opening chat...');\n        } else {\n          alert('⚠️ No vendor available for urgent dispatch. Submitting RFQ instead.');\n          setShowReview(true);\n        }\n      } catch (err) {\n        console.error('Urgent dispatch failed:', err);\n        setShowReview(true);\n      }\n    });\n    return function handleUrgentDispatch() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var handleRFQSubmit = function () {\n    var _ref3 = _asyncToGenerator(function* (editedTicket) {\n      try {\n        var res = yield axios.post('hhttps://rfq-a1og.onrender.com/submit-rfq', editedTicket);\n        console.log('RFQ submitted:', res.data);\n        setShowReview(false);\n        onBackToHome();\n      } catch (err) {\n        ß;\n        console.error('Error submitting RFQ:', err);\n        alert('Failed to submit RFQ. Please try again.');\n      }\n    });\n    return function handleRFQSubmit(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  return showReview ? _jsx(ReviewTicketScreen, {\n    chatHistory: chatHistory,\n    onSubmit: handleRFQSubmit,\n    onBack: function onBack() {\n      return setShowReview(false);\n    }\n  }) : _jsx(ChatScreen, {\n    messages: messages,\n    onUpdate: handleChatUpdate,\n    onManualSubmit: handleManualSubmit,\n    onUrgentHelp: handleUrgentDispatch\n  });\n}","map":{"version":3,"names":["React","useState","ChatScreen","ReviewTicketScreen","axios","jsx","_jsx","ChatFlowRouter","_ref","onBackToHome","_useState","_useState2","_slicedToArray","messages","setMessages","_useState3","_useState4","chatHistory","setChatHistory","_useState5","_useState6","showReview","setShowReview","_useState7","_useState8","chatRoomId","setChatRoomId","handleChatUpdate","newMessages","fullTranscript","highConfidence","some","m","role","content","toLowerCase","includes","handleManualSubmit","handleUrgentDispatch","_ref2","_asyncToGenerator","res","post","chat_history","data","success","chat_room_id","alert","err","console","error","apply","arguments","handleRFQSubmit","_ref3","editedTicket","log","ß","_x","onSubmit","onBack","onUpdate","onManualSubmit","onUrgentHelp"],"sources":["/Users/michaelverwaayen/RFQ/mobile/ChatFlowRouter.js"],"sourcesContent":["import React, { useState } from 'react';\nimport ChatScreen from './ChatScreen';\nimport ReviewTicketScreen from './ReviewTicketScreen';\nimport axios from 'axios';\n\nexport default function ChatFlowRouter({ onBackToHome }) {\n  const [messages, setMessages] = useState([]);\n  const [chatHistory, setChatHistory] = useState('');\n  const [showReview, setShowReview] = useState(false);\n  const [chatRoomId, setChatRoomId] = useState(null);\n\n  const handleChatUpdate = (newMessages, fullTranscript) => {\n    setMessages(newMessages);\n    setChatHistory(fullTranscript);\n\n    const highConfidence = newMessages.some(m =>\n      m.role === 'assistant' &&\n      (m.content.toLowerCase().includes('confidence: 85') ||\n       m.content.toLowerCase().includes('high confidence'))\n    );\n\n    if (highConfidence) {\n      setShowReview(true);\n    }\n  };\n\n  const handleManualSubmit = () => {\n    setShowReview(true);\n  };\n\n  const handleUrgentDispatch = async () => {\n    try {\n      const res = await axios.post('https://rfq-a1og.onrender.com/dispatch_urgent_vendor', {\n        chat_history: chatHistory\n      });\n\n      if (res.data.success && res.data.chat_room_id) {\n        setChatRoomId(res.data.chat_room_id);\n        alert('✅ Urgent vendor found. Opening chat...');\n        // Optional: Navigate to VendorChatRoom\n      } else {\n        alert('⚠️ No vendor available for urgent dispatch. Submitting RFQ instead.');\n        setShowReview(true);\n      }\n    } catch (err) {\n      console.error('Urgent dispatch failed:', err);\n      setShowReview(true);\n    }\n  };\n\n  const handleRFQSubmit = async (editedTicket) => {\n    try {\n      const res = await axios.post('hhttps://rfq-a1og.onrender.com/submit-rfq', editedTicket);\n      console.log('RFQ submitted:', res.data);\n      setShowReview(false);\n      onBackToHome();\n    } catch (err) {ß\n      console.error('Error submitting RFQ:', err);\n      alert('Failed to submit RFQ. Please try again.');\n    }\n  };\n\n  return showReview ? (\n    <ReviewTicketScreen\n      chatHistory={chatHistory}\n      onSubmit={handleRFQSubmit}\n      onBack={() => setShowReview(false)}\n    />\n  ) : (\n    <ChatScreen\n      messages={messages}\n      onUpdate={handleChatUpdate}\n      onManualSubmit={handleManualSubmit}\n      onUrgentHelp={handleUrgentDispatch}\n    />\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}