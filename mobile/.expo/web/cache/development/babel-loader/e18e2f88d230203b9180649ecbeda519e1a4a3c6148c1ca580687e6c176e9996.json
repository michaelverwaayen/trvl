{"ast":null,"code":"var _jsxFileName = \"/Users/michaelverwaayen/RFQ/mobile/ChatScreen.js\";\nimport { EventSourcePolyfill } from 'event-source-polyfill';\nimport React, { useState, useEffect } from 'react';\nimport Picker from \"react-native-web/dist/exports/Picker\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport * as ImagePicker from 'expo-image-picker';\nimport axios from 'axios';\nimport ChatRoom from './ChatRoom';\nimport { useTheme } from './ThemeContext';\nimport { supabase } from './supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatScreen() {\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [sending, setSending] = useState(false);\n  const [urgentChatId, setUrgentChatId] = useState(null);\n  const [inUrgentChat, setInUrgentChat] = useState(false);\n  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);\n  const [categories, setCategories] = useState([]);\n  const [selectedCategory, setSelectedCategory] = useState('');\n  const {\n    theme\n  } = useTheme();\n  const styles = getStyles(theme);\n  useEffect(() => {\n    const fetchCategories = async () => {\n      const {\n        data,\n        error\n      } = await supabase.from('vendors').select('category').neq('category', '');\n      if (data) {\n        const uniqueCategories = [...new Set(data.map(v => v.category))];\n        setCategories(uniqueCategories);\n      }\n    };\n    fetchCategories();\n  }, []);\n  const sendMessage = async (text = null, image = null) => {\n    if (!text && !image) return;\n    let query = '';\n    try {\n      query = new URLSearchParams({\n        text: text || '',\n        image: image || ''\n      }).toString();\n    } catch (e) {\n      console.error('❌ Failed to build query string:', e);\n      return;\n    }\n    if (image && !image.startsWith('data:image/')) {\n      console.warn('⚠️ Invalid image format submitted.');\n      return;\n    }\n    const userMessage = {\n      role: 'user',\n      type: image ? 'image' : 'text',\n      content: text || image\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setInput('');\n    setSending(true);\n    try {\n      const eventSource = new EventSourcePolyfill(`http://localhost:3000/chat?${query}`);\n      let fullResponse = '';\n      let done = false;\n      const timeoutId = setTimeout(() => {\n        if (!done) {\n          console.warn('⏰ SSE timed out. Closing connection.');\n          eventSource.close();\n          setSending(false);\n          setMessages(prev => [...prev, {\n            role: 'assistant',\n            type: 'text',\n            content: 'Sorry, the server timed out.'\n          }]);\n        }\n      }, 30000);\n      eventSource.onmessage = event => {\n        if (done) return;\n        if (event.data === '[DONE]') {\n          done = true;\n          clearTimeout(timeoutId);\n          setSending(false);\n          eventSource.close();\n          return;\n        }\n        fullResponse += event.data;\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last?.role === 'assistant') {\n            return [...prev.slice(0, -1), Object.assign({}, last, {\n              content: fullResponse\n            })];\n          } else {\n            return [...prev, {\n              role: 'assistant',\n              type: 'text',\n              content: event.data\n            }];\n          }\n        });\n      };\n      eventSource.onerror = e => {\n        if (!done) {\n          console.error('🔥 SSE stream error:', e);\n          setMessages(prev => [...prev, {\n            role: 'assistant',\n            type: 'text',\n            content: 'There was a connection issue. Please try again.'\n          }]);\n          clearTimeout(timeoutId);\n          setSending(false);\n          eventSource.close();\n        }\n      };\n    } catch (err) {\n      console.error('❌ Error sending message:', err);\n      setMessages(prev => [...prev, {\n        role: 'assistant',\n        type: 'text',\n        content: 'Something went wrong. Please try again.'\n      }]);\n      setSending(false);\n    }\n  };\n  const handleGetHelpNow = async () => {\n    if (!showCategoryDropdown) {\n      setShowCategoryDropdown(true);\n      return;\n    }\n    if (!selectedCategory) {\n      alert('Please select a category.');\n      return;\n    }\n    const fullTranscript = messages.map(m => m.content).join('\\n');\n    try {\n      const res = await axios.post('http://localhost:3000/dispatch_urgent_vendor', {\n        chat_history: fullTranscript,\n        category: selectedCategory\n      });\n      if (res.data.success && res.data.chat_room_id) {\n        console.log('🚀 Urgent chat initiated:', res.data.chat_room_id);\n        setUrgentChatId(res.data.chat_room_id);\n        setInUrgentChat(true);\n      } else {\n        alert('No vendor available right now. Continuing with RFQ.');\n      }\n    } catch (err) {\n      console.error('Urgent dispatch failed:', err);\n      alert('Something went wrong while dispatching.');\n    }\n  };\n  const pickImage = async () => {\n    const result = await ImagePicker.launchCameraAsync({\n      base64: true\n    });\n    if (!result.canceled) {\n      const base64Image = `data:image/jpeg;base64,${result.assets[0].base64}`;\n      sendMessage(null, base64Image);\n    }\n  };\n  const renderItem = ({\n    item,\n    index\n  }) => _jsxDEV(View, {\n    style: [styles.message, item.role === 'user' ? styles.user : styles.assistant],\n    children: item.type === 'image' && item.content ? _jsxDEV(Image, {\n      source: {\n        uri: item.content\n      },\n      style: styles.image\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }, this) : _jsxDEV(Text, {\n      style: item.role === 'user' ? styles.userText : styles.assistantText,\n      children: item.content || '⚠️ Empty message'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }, this)\n  }, item.id || index, false, {\n    fileName: _jsxFileName,\n    lineNumber: 190,\n    columnNumber: 5\n  }, this);\n  if (inUrgentChat && urgentChatId) {\n    return _jsxDEV(ChatRoom, {\n      chatRoomId: urgentChatId,\n      sender: \"user@example.com\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 12\n    }, this);\n  }\n  return _jsxDEV(KeyboardAvoidingView, {\n    style: styles.container,\n    behavior: Platform.OS === 'ios' ? 'padding' : undefined,\n    keyboardVerticalOffset: 100,\n    children: [_jsxDEV(FlatList, {\n      data: messages,\n      renderItem: renderItem,\n      keyExtractor: (item, idx) => item.id?.toString() || idx.toString(),\n      contentContainerStyle: {\n        paddingBottom: 20\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, this), _jsxDEV(View, {\n      style: styles.inputRow,\n      children: [_jsxDEV(TextInput, {\n        style: styles.input,\n        placeholder: \"Describe your issue...\",\n        value: input,\n        onChangeText: setInput,\n        editable: !sending\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this), _jsxDEV(Button, {\n        title: \"Send\",\n        onPress: () => sendMessage(input),\n        disabled: sending\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this), _jsxDEV(TouchableOpacity, {\n        onPress: pickImage,\n        style: styles.imageBtn,\n        children: _jsxDEV(Text, {\n          style: {\n            fontSize: 20\n          },\n          children: \"\\uD83D\\uDCF7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this), showCategoryDropdown && _jsxDEV(Picker, {\n      selectedValue: selectedCategory,\n      onValueChange: itemValue => setSelectedCategory(itemValue),\n      style: {\n        marginTop: 10,\n        color: theme.text,\n        backgroundColor: theme.card\n      },\n      children: [_jsxDEV(Picker.Item, {\n        label: \"Select a category\",\n        value: \"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 11\n      }, this), categories.map((cat, idx) => _jsxDEV(Picker.Item, {\n        label: cat,\n        value: cat\n      }, idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 9\n    }, this), sending && _jsxDEV(ActivityIndicator, {\n      style: {\n        marginTop: 10\n      },\n      size: \"small\",\n      color: theme.primary\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 19\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 209,\n    columnNumber: 5\n  }, this);\n}\nconst getStyles = theme => StyleSheet.create({\n  container: {\n    flex: 1,\n    padding: 10,\n    paddingTop: 50,\n    backgroundColor: theme.background\n  },\n  message: {\n    padding: 10,\n    marginVertical: 5,\n    borderRadius: 8,\n    maxWidth: '80%'\n  },\n  user: {\n    alignSelf: 'flex-end',\n    backgroundColor: theme.card\n  },\n  assistant: {\n    alignSelf: 'flex-start',\n    backgroundColor: theme.card\n  },\n  inputRow: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    marginTop: 10\n  },\n  input: {\n    flex: 1,\n    borderWidth: 1,\n    borderColor: theme.border,\n    borderRadius: 5,\n    padding: 10,\n    marginRight: 5,\n    color: theme.text\n  },\n  image: {\n    width: 150,\n    height: 150,\n    borderRadius: 8\n  },\n  imageBtn: {\n    marginLeft: 5,\n    padding: 8\n  },\n  manualRow: {\n    marginTop: 10\n  },\n  userText: {\n    color: '#FFFFFF'\n  },\n  assistantText: {\n    color: '#FFA500'\n  }\n});","map":{"version":3,"names":["EventSourcePolyfill","React","useState","useEffect","Picker","View","TextInput","Button","FlatList","Text","Image","StyleSheet","TouchableOpacity","KeyboardAvoidingView","Platform","ActivityIndicator","ImagePicker","axios","ChatRoom","useTheme","supabase","jsxDEV","_jsxDEV","ChatScreen","messages","setMessages","input","setInput","sending","setSending","urgentChatId","setUrgentChatId","inUrgentChat","setInUrgentChat","showCategoryDropdown","setShowCategoryDropdown","categories","setCategories","selectedCategory","setSelectedCategory","theme","styles","getStyles","fetchCategories","data","error","from","select","neq","uniqueCategories","Set","map","v","category","sendMessage","text","image","query","URLSearchParams","toString","e","console","startsWith","warn","userMessage","role","type","content","prev","eventSource","fullResponse","done","timeoutId","setTimeout","close","onmessage","event","clearTimeout","last","length","slice","Object","assign","onerror","err","handleGetHelpNow","alert","fullTranscript","m","join","res","post","chat_history","success","chat_room_id","log","pickImage","result","launchCameraAsync","base64","canceled","base64Image","assets","renderItem","item","index","style","message","user","assistant","children","source","uri","fileName","_jsxFileName","lineNumber","columnNumber","userText","assistantText","id","chatRoomId","sender","container","behavior","OS","undefined","keyboardVerticalOffset","keyExtractor","idx","contentContainerStyle","paddingBottom","inputRow","placeholder","value","onChangeText","editable","title","onPress","disabled","imageBtn","fontSize","selectedValue","onValueChange","itemValue","marginTop","color","backgroundColor","card","Item","label","cat","size","primary","create","flex","padding","paddingTop","background","marginVertical","borderRadius","maxWidth","alignSelf","flexDirection","alignItems","borderWidth","borderColor","border","marginRight","width","height","marginLeft","manualRow"],"sources":["/Users/michaelverwaayen/RFQ/mobile/ChatScreen.js"],"sourcesContent":["import { EventSourcePolyfill } from 'event-source-polyfill';\nimport React, { useState, useEffect } from 'react';\nimport { Picker } from 'react-native';\n\nimport {\n  View,\n  TextInput,\n  Button,\n  FlatList,\n  Text,\n  Image,\n  StyleSheet,\n  TouchableOpacity,\n  KeyboardAvoidingView,\n  Platform,\n  ActivityIndicator\n} from 'react-native';\nimport * as ImagePicker from 'expo-image-picker';\nimport axios from 'axios';\nimport ChatRoom from './ChatRoom';\nimport { useTheme } from './ThemeContext';\nimport { supabase } from './supabase';\n\nexport default function ChatScreen() {\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [sending, setSending] = useState(false);\n  const [urgentChatId, setUrgentChatId] = useState(null);\n  const [inUrgentChat, setInUrgentChat] = useState(false);\n  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);\n  const [categories, setCategories] = useState([]);\n  const [selectedCategory, setSelectedCategory] = useState('');\n  const { theme } = useTheme();\n  const styles = getStyles(theme);\n\n  useEffect(() => {\n    const fetchCategories = async () => {\n      const { data, error } = await supabase.from('vendors').select('category').neq('category', '');\n      if (data) {\n        const uniqueCategories = [...new Set(data.map(v => v.category))];\n        setCategories(uniqueCategories);\n      }\n    };\n    fetchCategories();\n  }, []);\n\n  const sendMessage = async (text = null, image = null) => {\n    if (!text && !image) return;\n\n    let query = '';\n    try {\n      query = new URLSearchParams({\n        text: text || '',\n        image: image || '',\n      }).toString();\n    } catch (e) {\n      console.error('❌ Failed to build query string:', e);\n      return;\n    }\n\n    if (image && !image.startsWith('data:image/')) {\n      console.warn('⚠️ Invalid image format submitted.');\n      return;\n    }\n\n    const userMessage = {\n      role: 'user',\n      type: image ? 'image' : 'text',\n      content: text || image,\n    };\n    setMessages(prev => [...prev, userMessage]);\n    setInput('');\n    setSending(true);\n\n    try {\n      const eventSource = new EventSourcePolyfill(\n        `http://localhost:3000/chat?${query}`\n      );\n\n      let fullResponse = '';\n      let done = false;\n\n      const timeoutId = setTimeout(() => {\n        if (!done) {\n          console.warn('⏰ SSE timed out. Closing connection.');\n          eventSource.close();\n          setSending(false);\n          setMessages(prev => [\n            ...prev,\n            {\n              role: 'assistant',\n              type: 'text',\n              content: 'Sorry, the server timed out.',\n            },\n          ]);\n        }\n      }, 30000);\n\n      eventSource.onmessage = (event) => {\n        if (done) return;\n        if (event.data === '[DONE]') {\n          done = true;\n          clearTimeout(timeoutId);\n          setSending(false);\n          eventSource.close();\n          return;\n        }\n\n        fullResponse += event.data;\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last?.role === 'assistant') {\n            return [...prev.slice(0, -1), { ...last, content: fullResponse }];\n          } else {\n            return [...prev, { role: 'assistant', type: 'text', content: event.data }];\n          }\n        });\n      };\n\n      eventSource.onerror = (e) => {\n        if (!done) {\n          console.error('🔥 SSE stream error:', e);\n          setMessages(prev => [\n            ...prev,\n            {\n              role: 'assistant',\n              type: 'text',\n              content: 'There was a connection issue. Please try again.',\n            },\n          ]);\n          clearTimeout(timeoutId);\n          setSending(false);\n          eventSource.close();\n        }\n      };\n    } catch (err) {\n      console.error('❌ Error sending message:', err);\n      setMessages(prev => [\n        ...prev,\n        {\n          role: 'assistant',\n          type: 'text',\n          content: 'Something went wrong. Please try again.',\n        },\n      ]);\n      setSending(false);\n    }\n  };\n\n  const handleGetHelpNow = async () => {\n    if (!showCategoryDropdown) {\n      setShowCategoryDropdown(true);\n      return;\n    }\n\n    if (!selectedCategory) {\n      alert('Please select a category.');\n      return;\n    }\n\n    const fullTranscript = messages.map(m => m.content).join('\\n');\n    try {\n      const res = await axios.post('http://localhost:3000/dispatch_urgent_vendor', {\n  chat_history: fullTranscript,\n  category: selectedCategory  // ✅ ADD THIS LINE\n});\n\n      if (res.data.success && res.data.chat_room_id) {\n        console.log('🚀 Urgent chat initiated:', res.data.chat_room_id);\n        setUrgentChatId(res.data.chat_room_id);\n        setInUrgentChat(true);\n      } else {\n        alert('No vendor available right now. Continuing with RFQ.');\n      }\n    } catch (err) {\n      console.error('Urgent dispatch failed:', err);\n      alert('Something went wrong while dispatching.');\n    }\n  };\n\n  const pickImage = async () => {\n    const result = await ImagePicker.launchCameraAsync({ base64: true });\n    if (!result.canceled) {\n      const base64Image = `data:image/jpeg;base64,${result.assets[0].base64}`;\n      sendMessage(null, base64Image);\n    }\n  };\n\n  const renderItem = ({ item, index }) => (\n    <View\n      key={item.id || index}\n      style={[styles.message, item.role === 'user' ? styles.user : styles.assistant]}\n    >\n      {item.type === 'image' && item.content ? (\n        <Image source={{ uri: item.content }} style={styles.image} />\n      ) : (\n        <Text style={item.role === 'user' ? styles.userText : styles.assistantText}>\n          {item.content || '⚠️ Empty message'}\n        </Text>\n      )}\n    </View>\n  );\n\n  if (inUrgentChat && urgentChatId) {\n    return <ChatRoom chatRoomId={urgentChatId} sender=\"user@example.com\" />;\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={styles.container}\n      behavior={Platform.OS === 'ios' ? 'padding' : undefined}\n      keyboardVerticalOffset={100}\n    >\n      <FlatList\n        data={messages}\n        renderItem={renderItem}\n        keyExtractor={(item, idx) => item.id?.toString() || idx.toString()}\n        contentContainerStyle={{ paddingBottom: 20 }}\n      />\n      <View style={styles.inputRow}>\n        <TextInput\n          style={styles.input}\n          placeholder=\"Describe your issue...\"\n          value={input}\n          onChangeText={setInput}\n          editable={!sending}\n        />\n        <Button title=\"Send\" onPress={() => sendMessage(input)} disabled={sending} />\n        <TouchableOpacity onPress={pickImage} style={styles.imageBtn}>\n          <Text style={{ fontSize: 20 }}>📷</Text>\n        </TouchableOpacity>\n      </View>\n\n      {showCategoryDropdown && (\n        <Picker\n          selectedValue={selectedCategory}\n          onValueChange={(itemValue) => setSelectedCategory(itemValue)}\n          style={{ marginTop: 10, color: theme.text, backgroundColor: theme.card }}\n        >\n          <Picker.Item label=\"Select a category\" value=\"\" />\n          {categories.map((cat, idx) => (\n            <Picker.Item key={idx} label={cat} value={cat} />\n          ))}\n        </Picker>\n      )}\n\n    \n\n      {sending && <ActivityIndicator style={{ marginTop: 10 }} size=\"small\" color={theme.primary} />}\n    </KeyboardAvoidingView>\n  );\n}\n\nconst getStyles = (theme) =>\n  StyleSheet.create({\n    container: { flex: 1, padding: 10, paddingTop: 50, backgroundColor: theme.background },\n    message: { padding: 10, marginVertical: 5, borderRadius: 8, maxWidth: '80%' },\n    user: { alignSelf: 'flex-end', backgroundColor: theme.card },\n    assistant: { alignSelf: 'flex-start', backgroundColor: theme.card },\n    inputRow: { flexDirection: 'row', alignItems: 'center', marginTop: 10 },\n    input: { flex: 1, borderWidth: 1, borderColor: theme.border, borderRadius: 5, padding: 10, marginRight: 5, color: theme.text },\n    image: { width: 150, height: 150, borderRadius: 8 },\n    imageBtn: { marginLeft: 5, padding: 8 },\n    manualRow: { marginTop: 10 },\n    userText: { color: '#FFFFFF' },\n    assistantText: { color: '#FFA500' }\n  });\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}